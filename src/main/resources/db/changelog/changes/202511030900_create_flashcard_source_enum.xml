<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
    http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-4.20.xsd">

    <!--
    ============================================================================
    Migration: Create flashcard_source_enum type
    ============================================================================
    Purpose: Create ENUM type to track the source/origin of flashcards
    
    Affected Objects:
    - Type: flashcard_source_enum
    
    Business Logic:
    - 'manual': Flashcard created manually by user
    - 'ai': Flashcard generated by AI and accepted without changes
    - 'ai-edited': AI-generated flashcard that was modified by user
    
    Notes:
    - This ENUM is required before creating the flashcards table
    - Changes to ENUM values require careful migration planning in PostgreSQL
    ============================================================================
    -->

    <changeSet id="202511030900-1" author="10xcards-system">
        <preConditions onFail="MARK_RAN">
            <not>
                <sqlCheck expectedResult="1">
                    select count(*) from pg_type where typname = 'flashcard_source_enum'
                </sqlCheck>
            </not>
        </preConditions>
        
        <comment>Create ENUM type for flashcard source tracking</comment>
        
        <sql><![CDATA[
            -- Create enum type for flashcard source
            -- This type is used to distinguish between manually created flashcards
            -- and those generated or edited via AI
            create type flashcard_source_enum as enum ('manual', 'ai', 'ai-edited');
        ]]></sql>
        
        <rollback><![CDATA[
            -- Drop the enum type
            -- WARNING: This will fail if any table is using this type
            drop type if exists flashcard_source_enum;
        ]]></rollback>
    </changeSet>

</databaseChangeLog>

